<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Carrito de Compras</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
</head>
<body class="bg-pink-50 min-h-screen">
  <!-- Navbar -->
  <nav class="bg-pink-600 p-4">
    <div class="container mx-auto flex justify-between items-center">
      <span class="text-white text-2xl font-bold">Mi Tienda</span>
      <div>
        <button class="relative text-white focus:outline-none" type="button" aria-label="Carrito">
          <svg class="w-6 h-6 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2 9m5-9v9m4-9v9m1-9h2a2 2 0 002-2V7a2 2 0 00-2-2h-2.4"></path>
          </svg>
          <span id="cart-count" class="absolute -top-2 -right-2 bg-pink-500 text-xs rounded-full px-2">0</span>
        </button>
      </div>
    </div>
  </nav>

  <!-- Main Content -->
  <div class="container mx-auto mt-8 flex flex-col md:flex-row gap-8">
    <!-- Bolsa de Productos -->
    <div class="w-full md:w-2/3">
      <h2 class="text-xl font-semibold mb-4 text-pink-700">Productos</h2>
      <div id="products" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6"></div>
      <p id="api-status" class="text-sm text-pink-600 mt-2">Solicitando productos…</p>
    </div>

    <!-- Carrito de Compras -->
    <div class="w-full md:w-1/3">
      <h2 class="text-xl font-semibold mb-4 text-pink-700">Carrito de Compras</h2>
      <div id="cart" class="bg-white rounded shadow p-4 min-h-[200px] border border-pink-100">
        <p class="text-pink-600">Agrega productos al carrito.</p>
      </div>
      <div class="mt-4 flex justify-between items-center">
        <span class="font-bold text-lg text-pink-800">Total:</span>
        <span id="cart-total" class="font-bold text-lg text-pink-800">$0.00</span>
      </div>
      <button class="mt-4 w-full bg-pink-600 text-white py-2 rounded hover:bg-pink-700 transition" type="button">Pagar</button>
    </div>
  </div>

  <script>
    // Estado del carrito: { [id]: { id, title, price, image, count } }
    const cart = {};

    function renderCart() {
      const $cart = $('#cart');
      const items = Object.values(cart);

      if (items.length === 0) {
        $cart.html('<p class="text-pink-600">Agrega productos al carrito.</p>');
        $('#cart-total').text('$0.00');
        $('#cart-count').text('0');
        return;
      }

      let total = 0;
      let countAll = 0;

      const html = items.map(item => {
        const lineTotal = item.price * item.count;
        total += lineTotal;
        countAll += item.count;
        return `
          <div class="flex items-center gap-3 py-2 border-b border-pink-100 last:border-b-0">
            <img src="${item.image}" alt="${item.title}" class="w-12 h-12 object-contain">
            <div class="flex-1">
              <p class="text-sm font-medium clamp-2 text-pink-800">${item.title}</p>
              <p class="text-xs text-pink-600">Cant: ${item.count} · $${item.price.toFixed(2)}</p>
            </div>
            <div class="text-sm font-semibold text-pink-700">$${lineTotal.toFixed(2)}</div>
          </div>
        `;
      }).join('');

      $cart.html(html);
      $('#cart-total').text(`$${total.toFixed(2)}`);
      $('#cart-count').text(String(countAll));
    }

    function addToCart(product) {
      const id = String(product.id);
      if (!cart[id]) {
        cart[id] = {
          id,
          title: product.title,
          price: Number(product.price) || 0,
          image: product.image || '',
          count: 0
        };
      }
      cart[id].count += 1;
      renderCart();
    }

    $(document).ready(function () {
      // Cargar productos
      $.ajax({
        method: 'GET',
        url: 'https://fakestoreapi.com/products?limit=10',
        dataType: 'json'
      })
      .done(function (products) {
        $('#api-status').text('Productos recibidos.');
        if (!Array.isArray(products) || products.length === 0) {
          $('#products').html('<p class="text-pink-700">No hay productos para mostrar.</p>');
          return;
        }

        const html = products.map(function (product) {
          const title = product.title ?? 'Producto';
          const image = product.image ?? '';
          const price = Number.isFinite(product.price) ? product.price : 0;

          return `
            <div class="bg-white rounded shadow p-4 flex flex-col items-center border border-pink-100">
              <img src="${image}" alt="${title}" class="h-32 object-contain mb-2" loading="lazy" width="128" height="128">
              <h3 class="font-semibold text-center mb-1 text-sm clamp-2 text-pink-900">${title}</h3>
              <span class="text-pink-600 font-bold mb-2">$${price.toFixed(2)}</span>
              <button
                class="add-to-cart bg-pink-600 text-white px-4 py-1 rounded hover:bg-pink-700 transition"
                type="button"
                data-id="${product.id}"
                data-title="${title}"
                data-price="${price}"
                data-image="${image}"
              >
                Agregar al carrito
              </button>
            </div>
          `;
        }).join('');

        $('#products').html(html);
      })
      .fail(function (jqXHR, textStatus) {
        console.error('Error en la solicitud:', textStatus);
        $('#api-status').text('Ocurrió un error al solicitar los productos.');
        $('#products').html('<p class="text-red-600">No se pudieron cargar los productos.</p>');
      });

      // Agregar al carrito
      $('#products').on('click', '.add-to-cart', function () {
        const $btn = $(this);
        const product = {
          id: $btn.data('id'),
          title: $btn.data('title'),
          price: Number($btn.data('price')) || 0,
          image: $btn.data('image') || ''
        };
        addToCart(product);
      });
    });
    /* 
    Código de render (placeholder) — NO USAR por ahora:
    products.forEach(function (product) {
      $('#products').append(`
        <div class="bg-white rounded shadow p-4 flex flex-col items-center">
          <img src="${product.image}" alt="${product.title}" class="h-32 object-contain mb-2">
          <h3 class="font-semibold text-center mb-1 text-sm">${product.title}</h3>
          <span class="text-blue-600 font-bold mb-2">$${product.price}</span>
        </div>
      `);
    });
    */
  </script>
</body>
</html>